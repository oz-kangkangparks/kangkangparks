# nginx 이미지 직접 서빙 설정
# 이 설정을 kangkangparks.com.conf 파일에 추가하세요

# Next.js 업스트림 (기존 설정 유지)
upstream kangkangparks-frontend {
    server kangkangparks-frontend:3000;
}

server {
    listen 443 ssl http2;
    server_name kangkangparks.com www.kangkangparks.com;

    # SSL 설정 (기존 유지)
    # ...

    # 이미지 직접 서빙 (Next.js 우회) ⭐ 이 부분을 추가!
    location /images/ {
        # Docker 컨테이너 내부 경로
        alias /app/.next/static/../../../public/images/;

        # 또는 더 간단하게 (Next.js standalone 구조)
        # root /app/public;

        # 캐싱 헤더 (1년)
        expires 1y;
        add_header Cache-Control "public, immutable";

        # CORS (필요시)
        add_header Access-Control-Allow-Origin "*";

        # 로그 비활성화 (성능 향상)
        access_log off;

        # Gzip 압축
        gzip on;
        gzip_types image/svg+xml image/webp;
        gzip_vary on;
    }

    # Next.js로 프록시 (/_next, API, 페이지 등)
    location / {
        proxy_pass http://kangkangparks-frontend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;

        # 타임아웃 설정
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
